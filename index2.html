<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
		<title>Space Demo</title>
		<link rel="stylesheet" href="stylesheets/screen.css" type="text/css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" type="text/javascript"></script>
		<script src="javascripts/jquery.hotkeys.js" type="text/javascript"></script>
		<script src="javascripts/key_status.js" type="text/javascript"></script>
		<script src="javascripts/util.js" type="text/javascript"></script>
		<script src="javascripts/sprite.js" type="text/javascript"></script>
	</head>
	<body>
		<h1>Space Demo</h1>
		<script type='text/javascript'>
			//<![CDATA[

			var CANVAS_WIDTH = 480;
			var CANVAS_HEIGHT = 320;

			var canvasElement = $("<canvas width='" + CANVAS_WIDTH + 
								  "' height='" + CANVAS_HEIGHT + "'></canvas>");
			var canvas = canvasElement.get(0).getContext("2d");
			canvasElement.appendTo('body');

			var FPS = 30;
			
			setInterval(function() {
				update();
				draw();
			}, 1000/FPS);

			var textX = 50;
			var textY = 50;

			function update() {			

			  if (keydown.left) {
				player.x -= 5;
			  }
			  if (keydown.right) {
				player.x += 5;
			  }
			  if (keydown.up) {
				player.y -= 5;
			  }
			  if (keydown.down) {
				player.y += 5;
			  }
			  
			  // ai movement
			  if (ai.x == CANVAS_WIDTH-ai.width){			  
				moveLeft = true;
			  }
			  if (ai.x == 0){
				moveLeft = false;
			  }
			  moveLeft == true ? ai.x -= 5 : ai.x += 5;

			  player.x = player.x.clamp(0, CANVAS_WIDTH - player.width);
			  ai.x = ai.x.clamp(0, CANVAS_WIDTH - ai.width);
			  
			  handleCollisions();
			
			}			
			
			function draw() {
			  canvas.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
			  player.draw();
			  ai.draw();
			  ball.draw();
			}
			
			var player = {
			  color: "#00A",
			  x: 220,
			  y: 270,
			  width: 96,
			  height: 32,
			  draw: function() {
				canvas.fillStyle = this.color;
				canvas.fillRect(this.x, this.y, this.width, this.height);
			  },
			  explode: function(){
				console.log("you hit the ball");
			  }
			};
			
			var ai = {
			  color: "#ccc",
			  x: 0,
			  y: 0,
			  width: 96,
			  height: 32,
			  draw: function() {
				canvas.fillStyle = this.color;
				canvas.fillRect(this.x, this.y, this.width, this.height);
			  }
			};
			
			var ball = {			
			  color:"pink",
			  x: 240,
			  y: 160,			
			  radius: 10,
     		  width: 32,
			  height: 32,	
			  draw: function() {
				canvas.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);
				canvas.stroke();
			  }
			}
			
			
			function collides(a, b) {
			 return a.x < b.x + b.width &&
			 a.x + a.width > b.x &&
			 a.y < b.y + b.height &&
			 a.y + a.height > b.y;
			}
			
			function handleCollisions() {			
				  if (collides(ball, player)) {
					player.explode();
				  }
			  /*enemies.forEach(function(enemy) {
				if (collides(enemy, player)) {
				  enemy.explode();
				  player.explode();
				}
			  });*/
			}
			
			//]]>
		</script>
	</body>
</html>
